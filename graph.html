<title>Smart Room Sensor</title>
<html>

<head>
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/morris.js/0.5.1/morris.css">
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/c3/0.4.11/c3.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.97.8/css/materialize.min.css">
    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.0/jquery.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/raphael/2.1.0/raphael-min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/morris.js/0.5.1/morris.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/materialize/0.97.8/js/materialize.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/d3/4.4.3/d3.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/c3/0.4.11/c3.js"></script>
</head>


<body>

<nav>
    <div class="nav-wrapper">
      <ul id="nav-mobile" class="left hide-on-med-and-down">
        <li><a href="index.html">Live</a></li>
        <li class="active"><a href="#">Usage</a></li>
      </ul>
    </div>
</nav>
<div class="container">
    <select id="building-select"></select>
    <div id="roomCount"></div>
</div>
</body>

<script>
var chart;
$(function(){
    $.get("db/getBuildings",function(data){
        console.log(data);
        $.each(data,function(i,value){
            $("#building-select").append(`<option value=${value}>${value}</option>`);
        });
        $("#building-select").val(data[0]);
        $("#building-select").change(load);
    });
    window.setInterval(update,1000);
});
function load(){
    var value = $("#building-select").val();
    $.get("db/getEnergy.php",{
        building: value
    },function(data){
        console.log("select loading");
        console.log(data);
        chart = c3.generate({
            bindto:"#roomCount",
            data:{
                url:'db/getEnergy.php'
            },
            keys:{
                value:['count']
            },
            x: 'time',
            xFormat: '%Y-%m-%d %H:%M:%S'
        });
    });
}
function update(){
    $.get("db/getEnergy.php",{
        floor:1,
        room:0
    },function(data){
        console.log("update");
        console.log(data);
    });
}
/*test = 30;
window.temp = 99;

setInterval(function(){ showCount(0, test); }, 1000);

function showCount(room) {
		window.test = 88;
        var xmlhttp = new XMLHttpRequest();
        xmlhttp.onreadystatechange = function() {
            if (this.readyState == 4 && this.status == 200) {
				test = this.responseText;
				if (test == temp) return;
				window.temp = test;
                document.getElementById("roomCount").innerText = test;
				anotherDataSet = [   
				{ y: '2003', a: 100, b: 80 },
				{ y: '2004', a: 100, b: 20 },
				{ y: '2005', a: 100, b: 30 },
				{ y: '2006', a: 100, b: 90 },
				{ y: '2007', a: 75,  b: 65 },
				{ y: '2008', a: 50,  b: test },
				{ y: '2009', a: 75,  b: 65 },
				{ y: '2010', a: 50,  b: 40 },
				{ y: '2011', a: 75,  b: 65 },
				{ y: '2012', a: 100, b: 90 }]
				graph.setData(anotherDataSet);
            }
        };
        xmlhttp.open("GET", "db/getCount.php?floor=1&room=" + room, true);
        xmlhttp.send();
    }*/

</script>


</html>